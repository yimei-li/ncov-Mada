inputs:
  - name: madagascar
    metadata: data/subsampled_metadata_gisaid_edit.tsv
    sequences: data/subsampled_sequences_gisaid.fasta

# Define locations for which builds should be created.
# For each build we specify a subsampling scheme via an explicit key.
builds:
  # first we'll define a country-level build, focused on Madagascar.
  # we'll define the sampling schemes below
  madagascar:
    subsampling_scheme: custom_mada # <- use the 'custom_mada' sampling scheme
    region: Africa
    country: Madagascar

# Define custom subsampling logic.
subsampling:
  custom_mada:
    # Focal samples for country
    country:
      # Use augur filter's query argument to filter strains with pandas-style logic expressions.
      # This can be easier to read than the corresponding filter by exclusion.
      query: --query "(country == 'Madagascar')"
    # Contextual samples from country's region but not including those from madagascar
    regionAfrica:
      group_by: "country year month"
      seq_per_group: 20
      query: --query "(country != 'Madagascar') & (region == 'Africa')"
      priorities:
        type: "proximity"
        focus: "country"
    # Contextual samples from Europe due to clear connectivity
    regionEurope:
      group_by: "country year month"
      seq_per_group: 20
      query: --query "(region == 'Europe')"
      priorities:
        type: "proximity"
        focus: "country"
    # Contextual samples from the rest of the world,
    # excluding Africa and Europe to avoid resampling.
    global:
      group_by: "country year month"
      seq_per_group: 10
      query: --query "(region != 'Africa') & (region != 'Europe')"
      priorities:
        type: "proximity"
        focus: "country"


# Here we can specify the colors file & auspice_config to be used for all of the
# above builds - unless otherwise specified in the builds above!
# If you don't specify these, the files in `default_config` folder will be used
files:
  auspice_config: "my_profiles/Madagascar/MadaV1_auspice_config.json"
  description: "my_profiles/Madagascar/MadaV1_description.md"

## You could also specify a title which will be used for all builds
## where you haven't already specified a title above:
## (Uncomment this to use!):
title: "SARS-CoV-2 Sequences in Madagascar"

#########
## Finally, you can specify what traits you want to reconstruct, per build.

## First, specify the traits you want to reconstruct, per build:
## (uncomment to use!)
traits:
  madagascar: # for the madagascar build
    columns: ["location", "division", "country"]

## ^ Note that the swiss samples do not have 'location' (typically, city)
## information, so this command would fail as-is - but for many other places
## there are samples with 'location' information.

##########
## If you want to modify parameters for the steps in the build - augur commands -
## you can copy these from the 'defaults/parameters.yaml' file:
## Here are some examples below - uncomment if you want to use them:

## Modify filter settings. By default we filter out sequences less than 27000 bases
## If you wanted to include slightly shorter sequeces, change this:
#filter:
#  min_length: 25000

## TreeTime settings for the 'refine' rule. By default we exclude sequences more than 
## 4 IQD from the root-to-tip vs clock regression. You can change this if you want to include
## more divergent sequences:
#refine:
#  clock_filter_iqd: 6

